{% extends "base_generic.html" %}

{% block content %}
  <h1>Search Results</h1>

  <div style="flex-grow: 1; padding: 20px;">
    {% if query %}
    <p>You searched for: <strong>{{ query }}</strong></p>
      <table id="dynamicTable" class="table table-hover">
        <thead>
          <tr class="table-primary">
            <th scope="col">Book</th>
            <th scope="col">Saga</th>
            <th scope="col">Author</th>
          </tr>
        </thead>
        <tbody>
          {% if book_results %}
              {% for book in book_results %}
              <tr class="table-secondary">
                <th scope="row">
                  <a class="no-underline" href="{{ book.get_absolute_url }}">{{ book.title }}</a>
                </th>
                <td>
                  {% if book.saga %}
                    <a class="no-underline" href="{{ book.saga.get_absolute_url }}">
                      {{ book.saga.name }}
                    </a>
                    #{{ book.saga_volume }}
                  {% endif %}
                </td>
                <td>
                  <a class="no-underline" href="{{ book.author.get_absolute_url }}">{{ book.author }}</a>
                </td>
              </tr>
              {% endfor %}
          {% endif%}
          {% if saga_results %}
              {% for saga in saga_results %}
                {% for book in saga.book_set.all|dictsort:"saga_volume" %}
                <tr class="table-secondary">
                  <th scope="row">
                    <a class="no-underline" href="{{ book.get_absolute_url }}">{{ book.title }}</a>
                  </th>
                  <td>
                    {% if book.saga %}
                      <a class="no-underline" href="{{ book.saga.get_absolute_url }}">
                        {{ book.saga.name }}
                      </a>
                      #{{ book.saga_volume }}
                    {% endif %}
                  </td>
                  <td>
                    <a class="no-underline" href="{{ book.author.get_absolute_url }}">{{ book.author }}</a>
                  </td>
                </tr>
                {% endfor %}
              {% endfor %}
          {% endif%}
          {% if author_results %}
            {% for author in author_results %}
              {% for book in author.book_set.all %}
              <tr class="table-secondary">
                <th scope="row">
                  <a class="no-underline" href="{{ book.get_absolute_url }}">{{ book.title }}</a>
                </th>
                <td>
                  {% if book.saga %}
                    <a class="no-underline" href="{{ book.saga.get_absolute_url }}">
                      {{ book.saga.name }}
                    </a>
                    #{{ book.saga_volume }}
                  {% endif %}
                </td>
                <td>
                  <a class="no-underline" href="{{ book.author.get_absolute_url }}">{{ book.author }}</a>
                </td>
              </tr>
              {% endfor %}
            {% endfor %}
        {% endif%}

          {% comment %} {% if saga_results %}
            <ul>
              {% for saga in saga_results %}
                <li>{{ saga.name }}</li>
              {% endfor %}
            </ul>
          {% endif%}
          {% if author_results %}
            <ul>
              {% for author in author_results %}
                <li>{{ author.first_name }} {{ author.last_name }}</li>
              {% endfor %}
            </ul>
          {% endif%} {% endcomment %}
        </tbody>
      </table>
    {% else %}
      <p>No hay autores en la biblioteca.</p>
    {% endif %} 
  </div>
  {% comment %} {% if query %}
    <p>You searched for: <strong>{{ query }}</strong></p>
    
    {% if book_results %}
      <ul>
        {% for book in book_results %}
          <li>{{ book.title }}</li>
        {% endfor %}
      </ul>
    {% else %}
      <p>No books found.</p>
    {% endif %}
    
    <h2>Authors</h2>
    {% if author_results %}
      <ul>
        {% for author in author_results %}
          <li>{{ author.first_name }} {{ author.last_name }}</li>
        {% endfor %}
      </ul>
    {% else %}
      <p>No authors found.</p>
    {% endif %}
    
    <h2>Sagas</h2>
    {% if saga_results %}
      <ul>
        {% for saga in saga_results %}
          <li>{{ saga.name }}</li>
        {% endfor %}
      </ul>
    {% else %}
      <p>No sagas found.</p>
    {% endif %}
    
  {% else %}
    <p>Please enter a search term.</p>
  {% endif %} {% endcomment %}
{% endblock %}